#!/bin/bash

# fix mac LC_CTYPE issue
# see: http://sourabhbajaj.com/python/2014/03/31/fix-valueerror-unknown-locale-utf-8/
if [[ "$LC_CTYPE" == 'UTF-8' ]]; then
  export LC_CTYPE="en_US.UTF-8"
fi

install_dir=/usr/local/opt

#export TERMINAL=xfce4-terminal
export EDITOR=nvim
export BROWSER=google-chrome

export PATH=$HOME/bin:/usr/local/bin:$PATH
export MANPATH="/usr/local/man:$MANPATH"

# go
export GOROOT=$install_dir/go
export GOPATH=$HOME/go
export PATH=$GOPATH/bin:$GOROOT/bin:$PATH

prompt_git_current_branch() {
    local ref
    ref=$(command git symbolic-ref --quiet HEAD 2> /dev/null)
    local ret=$?
    if [[ $ret != 0 ]]; then
        [[ $ret == 128 ]] && return  # no git repo.
        ref=$(command git rev-parse --short HEAD 2> /dev/null) || return
    fi
    echo ${ref#refs/heads/}
}

# Check https://github.com/sindresorhus/pure/blob/master/pure.zsh.
prompt() {
    local branch=$(prompt_git_current_branch)
    local kubectx=$(cat ~/.kube/config | grep 'current-context:' | cut -d ' ' -f 2)

    # Prompt turns red if the previous command didn't exit with 0.
    echo "%(?.%F{242}.%F{red})%~%f (%F{blue}$branch%f) (%F{blue}$kubectx%f)\n%(?.%F{green}.%F{red})‚ùØ%f "
}

PROMPT=$(prompt)
